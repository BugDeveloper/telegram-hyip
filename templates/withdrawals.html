{% extends 'base.html' %}
{% block content %}
<table style="max-width: 1500px; margin: auto;">
    <tr>
        <td style="padding:0 15px 0 15px;">
            <b>
                Username
            </b>
        </td>
        <td style="padding:0 15px 0 15px;">
            <b>
                Wallet
            </b>
        </td>
        <td style="padding:0 15px 0 15px;">
            <b>
                Amount
            </b>
        </td>
        <td style="padding:0 15px 0 15px;">
            <b>
                Date and time
            </b>
        </td>
    </tr>
    <tr>
    {% for withdrawal in withdrawals %}
        <td style="padding:0 15px 0 15px;">
            <a href="https://telegram.me/{{ withdrawal.user.username }}">
                {{ withdrawal.user.username }}
            </a>
        </td>
        <td style="padding:0 15px 0 15px;">{{ withdrawal.user.wallet }}</td>
        <td style="padding:0 15px 0 15px;">{{ withdrawal.amount }}</td>
        <td style="padding:0 15px 0 15px;">{{ withdrawal.created_at.strftime('%Y %B %d %H:%M') }}</td>
        <td>
            <button type="button" onclick="approveWithdrawal({{withdrawal.id}})">Одобрить</button>
        </td>
    </tr>
  {% endfor %}
</table>
<script>
    function approveWithdrawal(id) {
        var xhr = new XMLHttpRequest();
        xhr.open("POST", '/approve_withdrawal', true);
        xhr.onreadystatechange = function (oEvent) {
            if (xhr.readyState === 4) {
                if (xhr.status === 200) {
                    location.reload(true);
                } else {
                    document.getElementById("errors").textContent = "Не вводи хуйню";
                }
            }
        };
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.send(JSON.stringify({
        'id': id
        }));
        window.location.reload();
    }
</script>
</body>
</html>
{% endblock %}
